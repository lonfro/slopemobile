<head>
 
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="TemplateData/unityloader41.js"></script>
    <script>
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/slope.json", { onProgress: UnityProgress, Module: { onRuntimeInitialized: function() { UnityProgress(gameInstance, "complete") } } });
    </script>
    <style>
        
    </style>
    
</head>

<body style="margin: 0; overflow: hidden;">
    <div class="webgl-content">
        <div id="gameContainer" style="width: 100%; height: 100%; margin: 0;"></div>
    </div>
    <script>

        const gameElement = document.getElementById('gameContainer');

        function simulateKeyPress(left, pressed) {
            const event = new KeyboardEvent(pressed ? 'keydown' : 'keyup', {
                key: keyCode == true ? 'a' : 'd',
                keyCode: keyCode,
                which: keyCode,
                bubbles: true,
                cancelable: true
            });
            document.dispatchEvent(event);
        }

        function simulateClick(touch, pressed) {
            
        }

        gameElement.addEventListener('touchstart', (event) => {
            
            for (const touch of event.changedTouches) {
                const simulatedEvent = new MouseEvent('mousedown', {
                    bubbles: true,
                    cancelable: true,
                    view: window,
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    button: 0
                });
        
            touch.target.dispatchEvent(simulatedEvent);

                // Calculate X relative to the container's left edge
                const bounds = gameElement.getBoundingClientRect();
                const touchX = touch.clientX - bounds.left;

                // Determine left or right half
                if (touchX < bounds.width / 2) {
                    simulateKeyPress(true, true);
                } else {
                    simulateKeyPress(false, true);
                }

            }

            event.preventDefault();
            event.stopImmediatePropagation();

            
        }, true);
        
        gameElement.addEventListener('touchend', (event) => {
            
            for (const touch of event.changedTouches) {
                const simulatedEvent = new MouseEvent('mouseup', {
                    bubbles: true,
                    cancelable: true,
                    view: window,
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    button: 0
                });
            
                touch.target.dispatchEvent(simulatedEvent);
                // Calculate X relative to the container's left edge
                const bounds = gameElement.getBoundingClientRect();
                const touchX = touch.clientX - bounds.left;

                // Determine left or right half
                if (touchX < bounds.width / 2) {
                    simulateKeyPress(true, false);
                } else {
                    simulateKeyPress(false, false);
                }                
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            
        }, true);



        


        
        
    </script>
    
</body>