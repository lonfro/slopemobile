<head>
 
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="TemplateData/unityloader41.js"></script>
    <script>
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/slope.json", { onProgress: UnityProgress, Module: { onRuntimeInitialized: function() { UnityProgress(gameInstance, "complete") } } });
    </script>
    <style>
        
    </style>
</head>

<body style="margin: 0; overflow: hidden;">
    <div class="webgl-content">
        <div id="gameContainer" style="width: 100%; height: 100%; margin: 0;"></div>
    </div>
    <script>
        const gameContainer = document.getElementById("gameContainer");

        let leftPressed = false;
        let rightPressed = false;

    

        

        function simulateKeyPress(keyCode) {
            const event = new KeyboardEvent('keydown', {
                key: keyCode === 65 ? 'a' : 'd',
                keyCode: keyCode,
                which: keyCode,
                bubbles: true,
                cancelable: true
            });
            document.dispatchEvent(event);
        }
        
        function simulateKeyRelease(keyCode) {
            const event = new KeyboardEvent('keyup', {
                key: keyCode === 65 ? 'a' : 'd',
                keyCode: keyCode,
                which: keyCode,
                bubbles: true,
                cancelable: true
            });
            document.dispatchEvent(event);
        }

        function handlePress(pressed, touchx) {
            let bounds = gameContainer.getBoundingClientRect();
            let realTouchX = touchx - bounds.left;
            let side = realTouchX > gameContainer.clientWidth / 2 ? "right" : "left";
            if (pressed) {
                if (side == "left") {
                    leftPressed = true;
                    simulateKeyPress(65);
                } else {
                    rightPressed = true;
                    simulateKeyPress(67);
                }

                if (leftPressed) {
                    
                }
                if (rightPressed) {
                    
                }
                
            } else {
                if (side == "left") {
                    simulateKeyRelease(65);
                    leftPressed = false;
                } else {
                    simulateKeyPress(67);
                    rightPressed = false;
                }
            }
            

        }

  // Prevent the delay between touch and click on some browsers
        gameContainer.addEventListener('touchstart', function(event) {
            event.preventDefault();
            event.stopImmediatePropagation();

            for (const touch of event.changedTouches) {


                handlePress(true, touch.clientX);



                const simulatedEvent = new MouseEvent('mousedown', {
                    bubbles: true,
                    cancelable: true,
                    view: window,
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    button: 0
                });
            
                touch.target.dispatchEvent(simulatedEvent);
                
            }
            
            //const touch = event.changedTouches[0];

            

            
            
        }, true);

        gameContainer.addEventListener('touchend', function(event) {
            event.preventDefault();
            event.stopImmediatePropagation();
            //const touch = event.changedTouches[0];
            for (const touch of event.changedTouches) {
                handlePress(false, touch.clientX);
                const simulatedEvent = new MouseEvent('mouseup', {
                    bubbles: true,
                    cancelable: true,
                    view: window,
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    button: 0
                });
                touch.target.dispatchEvent(simulatedEvent);
                

            }
            
            //handlePress(false, touch.clientX);

            
            
            
        }, true);
    </script>

</body>
